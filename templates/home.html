{% extends 'layout.html' %}
{% block content %}
<div class="section">
	<h2>Welcome, {{ username }}</h2>
	{% if forgotten_open %}
	<div class="flash warning">You forgot to check out yesterday ({{ forgotten_open['work_date'] }}) at {{ forgotten_open['check_in'] }}.</div>
	{% endif %}
</div>

<div class="grid-3 section">
	<div class="kpi"><div class="label">Default Hourly Rate</div><div class="value">{{ '%.2f'|format(default_rate) }}</div></div>
	<div class="kpi"><div class="label">Today</div><div class="value">{{ today.strftime('%Y-%m-%d') }}</div></div>
	<div class="kpi"><div class="label">Status</div><div class="value">{% if today_entry and not today_entry['check_out'] %}<span class="badge">Checked In</span>{% elif today_entry and today_entry['check_out'] %}<span class="badge">Completed</span>{% else %}<span class="badge">Idle</span>{% endif %}</div></div>
</div>

<div class="grid-2 section">
	<div class="card">
		<h3>Update Default Rate</h3>
		<form action="{{ url_for('update_default_rate') }}" method="post" class="form-grid">
			<label>Hourly Rate
				<input type="number" step="0.01" min="0" name="hourly_rate" value="{{ '%.2f'|format(default_rate) }}" required />
			</label>
			<button class="btn primary" type="submit">Save</button>
		</form>
	</div>

	<div class="card">
		<h3>Quick Actions</h3>
		<div class="row-actions">
			<form method="post" action="{{ url_for('check_in') }}">
				<button class="btn primary" type="submit" {% if today_entry and not today_entry['check_out'] %}disabled{% endif %}>Check In</button>
			</form>
			<form method="post" action="{{ url_for('check_out') }}">
				<button class="btn ghost" type="submit" {% if not today_entry or (today_entry and today_entry['check_out']) %}disabled{% endif %}>Check Out</button>
			</form>
		</div>
		{% if today_entry %}
			<div style="margin-top:0.75rem">
				<div class="label">Today Record</div>
				<div class="value">In: {{ today_entry['check_in'] or '-' }} | Out: {{ today_entry['check_out'] or '-' }} | Hours: {{ today_entry['total_hours'] or 0 }} | Rate: {{ today_entry['hourly_rate'] or default_rate }} | Salary: {{ today_entry['daily_salary'] or 0 }}</div>
			</div>
		{% endif %}
	</div>
</div>
{% endblock %}
